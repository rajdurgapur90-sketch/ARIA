<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Login</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; overflow-x: hidden; }
        
        /* Background & Animation Styles */
        .container {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a1f 0%, #1a0a2e 25%, #2d1b4e 50%, #1a0a2e 75%, #0a0a1f 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            position: relative;
            overflow: hidden;
        }
        @keyframes gradientShift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        
        .stars { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle ease-in-out infinite; box-shadow: 0 0 6px rgba(255, 255, 255, 0.8); }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        
        .glow-orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.3; pointer-events: none; z-index: 0; animation: floatOrb 20s ease-in-out infinite; }
        .orb-1 { width: 400px; height: 400px; background: radial-gradient(circle, #9333ea, transparent); top: -100px; left: -100px; }
        .orb-2 { width: 500px; height: 500px; background: radial-gradient(circle, #ec4899, transparent); bottom: -150px; right: -150px; animation-delay: -5s; }
        .orb-3 { width: 350px; height: 350px; background: radial-gradient(circle, #3b82f6, transparent); top: 50%; left: 50%; animation-delay: -10s; }
        @keyframes floatOrb { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 33% { transform: translate(100px, -100px) rotate(120deg); } 66% { transform: translate(-100px, 100px) rotate(240deg); } }

        /* Auth Panel Styles */
        .auth-container { position: relative; z-index: 10; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .auth-panel {
            background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(20px); border-radius: 1.5rem;
            box-shadow: 0 25px 60px -12px rgba(147, 51, 234, 0.4), 0 0 0 1px rgba(147, 51, 234, 0.3);
            padding: 2.5rem; width: 100%; max-width: 28rem; border: 1px solid rgba(147, 51, 234, 0.5);
            animation: slideUp 0.6s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .auth-header { text-align: center; margin-bottom: 2rem; }
        .icon-badge {
            display: inline-block; padding: 1.2rem; background: linear-gradient(135deg, #9333ea, #ec4899);
            border-radius: 50%; margin-bottom: 1.5rem; animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            box-shadow: 0 0 30px rgba(147, 51, 234, 0.6);
        }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.05); } }
        .icon-badge svg { width: 44px; height: 44px; color: white; }
        
        h2 { font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, #fff, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.75rem; }
        .subtitle { color: #9ca3af; font-size: 0.95rem; }
        
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; font-size: 0.875rem; font-weight: 500; color: #d1d5db; margin-bottom: 0.5rem; }
        .input-wrapper { position: relative; }
        
        input {
            width: 100%; padding: 0.875rem 1rem; background: rgba(55, 65, 81, 0.6);
            border: 1.5px solid rgba(75, 85, 99, 0.5); border-radius: 0.75rem; color: white;
            font-size: 1rem; transition: all 0.3s;
        }
        input[type="password"] { padding-right: 3rem; }
        input::placeholder { color: #6b7280; }
        input:focus { outline: none; border-color: #9333ea; background: rgba(55, 65, 81, 0.8); box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.2); transform: translateY(-2px); }
        input.error { border-color: #ef4444; animation: shake 0.5s ease; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        .toggle-password {
            position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: #9ca3af; cursor: pointer; padding: 0.25rem; transition: all 0.3s;
        }
        .toggle-password:hover { color: #c084fc; transform: translateY(-50%) scale(1.1); }
        .toggle-password svg { width: 20px; height: 20px; }
        
        .error-message { margin-top: 0.5rem; font-size: 0.875rem; color: #fca5a5; display: none; }
        .error-message.visible { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .password-requirements { margin-top: 0.75rem; padding: 1rem; background: rgba(31, 41, 55, 0.5); border-radius: 0.5rem; font-size: 0.75rem; border: 1px solid rgba(147, 51, 234, 0.3); }
        .requirements-title { color: #c084fc; margin-bottom: 0.5rem; font-weight: 600; }
        .requirements-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
        .requirement { color: #6b7280; transition: all 0.3s ease; }
        .requirement.met { color: #10b981; font-weight: 500; }
        
        .remember-me { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; }
        .remember-me input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #9333ea; }
        .remember-me label { margin: 0; cursor: pointer; font-size: 0.875rem; color: #d1d5db; }
        
        .btn-primary {
            width: 100%; padding: 0.875rem; background: linear-gradient(135deg, #9333ea, #ec4899);
            color: white; border: none; border-radius: 0.75rem; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s; box-shadow: 0 10px 25px -5px rgba(147, 51, 234, 0.5);
            position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 15px 35px -5px rgba(147, 51, 234, 0.7); }
        .btn-primary:active { transform: translateY(0); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        
        /* Loading Spinner */
        .spinner {
            width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite;
            display: none;
        }
        .btn-primary.loading .spinner { display: block; }
        .btn-primary.loading span { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .toggle-auth { margin-top: 1.5rem; text-align: center; }
        .toggle-auth button { background: none; border: none; color: #c084fc; font-size: 0.875rem; cursor: pointer; transition: all 0.3s; padding: 0.5rem; }
        .toggle-auth button:hover { color: #d8b4fe; text-decoration: underline; }
        
        .hidden { display: none; }

        /* --- TOAST NOTIFICATIONS --- */
        #toast-container {
            position: fixed; top: 20px; right: 20px; z-index: 2000;
            display: flex; flex-direction: column; gap: 10px; pointer-events: none;
        }
        .toast {
            display: flex; align-items: flex-start; gap: 12px; padding: 16px;
            background: rgba(17, 24, 39, 0.95); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px;
            color: #fff; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transform: translateX(120%); transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px; pointer-events: auto;
        }
        .toast.show { transform: translateX(0); }
        .toast.success { border-left: 4px solid #10b981; }
        .toast.error { border-left: 4px solid #ef4444; }
        .toast-icon { width: 20px; height: 20px; margin-top: 2px; flex-shrink: 0; }
        .toast.success .toast-icon { color: #10b981; }
        .toast.error .toast-icon { color: #ef4444; }
        .toast-content { display: flex; flex-direction: column; gap: 2px; }
        .toast-title { font-weight: 600; font-size: 0.95rem; color: #fff; }
        .toast-message { font-size: 0.85rem; color: #9ca3af; line-height: 1.4; }
    </style>
</head>

<body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <div class="container">
        <div class="stars" id="starsContainer"></div>
        <div class="glow-orb orb-1"></div>
        <div class="glow-orb orb-2"></div>
        <div class="glow-orb orb-3"></div>

        <div id="authScreen" class="auth-container">
            <div class="auth-panel">
                <div class="auth-header">
                    <div class="icon-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <h2 id="authTitle">Welcome Back</h2>
                    <p class="subtitle" id="authSubtitle">Sign in to your dashboard</p>
                </div>
                <form id="authForm">
                    <div id="usernameGroup" class="form-group hidden">
                        <label>Username</label>
                        <input type="text" id="username" placeholder="Enter username">
                        <p class="error-message hidden" id="usernameError"></p>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter email">
                        <p class="error-message hidden" id="emailError"></p>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <div class="input-wrapper">
                            <input type="password" id="password" placeholder="Enter password">
                            <button type="button" class="toggle-password" id="togglePassword">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="error-message hidden" id="passwordError"></p>
                        <div id="passwordRequirements" class="password-requirements hidden">
                            <p class="requirements-title">Password must contain:</p>
                            <div class="requirements-grid">
                                <span class="requirement" id="req-length">✓ 8+ characters</span>
                                <span class="requirement" id="req-upper">✓ Uppercase letter</span>
                                <span class="requirement" id="req-lower">✓ Lowercase letter</span>
                                <span class="requirement" id="req-number">✓ Number</span>
                                <span class="requirement" id="req-special">✓ Special character</span>
                            </div>
                        </div>
                    </div>
                    <div id="confirmPasswordGroup" class="form-group hidden">
                        <label>Confirm Password</label>
                        <div class="input-wrapper">
                            <input type="password" id="confirmPassword" placeholder="Confirm password">
                            <button type="button" class="toggle-password" id="toggleConfirmPassword">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="error-message hidden" id="confirmPasswordError"></p>
                    </div>
                    <div id="rememberMeGroup" class="remember-me">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">Remember me</label>
                    </div>
                    <button type="submit" class="btn-primary" id="authButton">
                        <span>Login</span>
                        <div class="spinner"></div>
                    </button>
                </form>
                <div class="toggle-auth">
                    <button type="button" id="toggleAuthMode">Don't have an account? Register</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // NOTE: Ensure this URL correctly points to your Google Apps Script Web App
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby-QpQtj42Nr5i-Sy6w-mmHDpA7XddMRW0ZD-K_xD7sBtaR1qQtWU9BvPuxWs_Ks98gUQ/exec"; 

        const state = {
            showRegister: false
        };

        function generateStars() {
            const c = document.getElementById('starsContainer');
            for (let i = 0; i < 200; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                s.style.left = Math.random() * 100 + '%';
                s.style.top = Math.random() * 100 + '%';
                const sz = Math.random() * 3 + 1;
                s.style.width = sz + 'px';
                s.style.height = sz + 'px';
                s.style.animationDuration = (Math.random() * 3 + 2) + 's';
                s.style.animationDelay = (Math.random() * 2) + 's';
                c.appendChild(s);
            }
        }

        // --- TOAST FUNCTION ---
        function showToast(message, type = 'error') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconSvg = type === 'success' 
                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />' 
                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />';
            
            const title = type === 'success' ? 'Success' : 'Error';

            toast.innerHTML = `
                <svg class="toast-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    ${iconSvg}
                </svg>
                <div class="toast-content">
                    <span class="toast-title">${title}</span>
                    <span class="toast-message">${message}</span>
                </div>
            `;

            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 4000);
        }

        function validateEmail(e) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

        function validatePassword(p) {
            return {
                isValid: p.length >= 8 && /[A-Z]/.test(p) && /[a-z]/.test(p) && /\d/.test(p) && /[!@#$%^&*(),.?":{}|<>]/.test(p),
                minLength: p.length >= 8,
                hasUpperCase: /[A-Z]/.test(p),
                hasLowerCase: /[a-z]/.test(p),
                hasNumber: /\d/.test(p),
                hasSpecialChar: /[!@#$%^&*(),.?":{}|<>]/.test(p)
            };
        }

        function updatePasswordRequirements() {
            const p = document.getElementById('password').value;
            const v = validatePassword(p);
            document.getElementById('req-length').classList.toggle('met', v.minLength);
            document.getElementById('req-upper').classList.toggle('met', v.hasUpperCase);
            document.getElementById('req-lower').classList.toggle('met', v.hasLowerCase);
            document.getElementById('req-number').classList.toggle('met', v.hasNumber);
            document.getElementById('req-special').classList.toggle('met', v.hasSpecialChar);
        }

        function clearError(f) {
            // Only clear field-level errors
            const el = document.getElementById(f);
            if (el) el.classList.remove('error');
            const err = document.getElementById(f + 'Error');
            if (err) err.classList.add('hidden');
        }

        function showError(f, m) {
            // Field-level error styling
            const el = document.getElementById(f);
            if (el) el.classList.add('error');
            const err = document.getElementById(f + 'Error');
            if (err) {
                err.textContent = m;
                err.classList.remove('hidden');
            }
        }

        function setLoading(isLoading) {
            const btn = document.getElementById('authButton');
            if (isLoading) {
                btn.classList.add('loading');
                btn.disabled = true;
            } else {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        function handleLogin() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            const r = document.getElementById('rememberMe').checked;
            let h = false;

            clearError('email'); clearError('password');

            if (!e) { showError('email', 'Email is required'); h = true; } 
            else if (!validateEmail(e)) { showError('email', 'Please enter a valid email address'); h = true; }

            if (!p) { showError('password', 'Password is required'); h = true; }

            if (!h) {
                if(GOOGLE_SCRIPT_URL.includes("example-url") || GOOGLE_SCRIPT_URL === "REPLACE_WITH_YOUR_URL") {
                    showToast("Please check the script URL configuration.", 'error');
                    return;
                }

                setLoading(true);

                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'login', email: e, password: p }),
                })
                .then(response => response.json())
                .then(data => {
                    setLoading(false);
                    if (data.result === 'success') {
                        if (r) localStorage.setItem('rememberedEmail', e);
                        else localStorage.removeItem('rememberedEmail');
                        
                        // --- UPDATED CODE START ---
                        // Forward credentials via sessionStorage
                        sessionStorage.setItem('activeUserEmail', e);
                        sessionStorage.setItem('activeUserPassword', p);
                        // --- UPDATED CODE END ---

                        showToast('Login successful! Redirecting...', 'success');
                        setTimeout(() => window.location.href = 'user_dashboard.html', 1500);
                    } else {
                        showToast(data.message || 'Authentication failed', 'error');
                    }
                })
                .catch(error => {
                    setLoading(false);
                    console.error('Error:', error);
                    showToast('Network error or server not responding.', 'error');
                });
            }
        }

        function handleRegister() {
            // Re-directing user to register.html
            window.location.href = 'register.html';
        }

        function toggleAuthMode() {
            // Since we split the pages, this button now just redirects
            window.location.href = 'register.html';
        }

        function togglePasswordVisibility(inputId, buttonId) {
            const inp = document.getElementById(inputId);
            const btn = document.getElementById(buttonId);
            const isPass = inp.type === 'password';
            inp.type = isPass ? 'text' : 'password';
            btn.innerHTML = isPass
                ? '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>';
        }

        document.getElementById('authForm').onsubmit = e => { e.preventDefault(); handleLogin(); };
        document.getElementById('toggleAuthMode').onclick = toggleAuthMode;
        document.getElementById('togglePassword').onclick = () => togglePasswordVisibility('password', 'togglePassword');
        document.getElementById('toggleConfirmPassword').onclick = () => togglePasswordVisibility('confirmPassword', 'toggleConfirmPassword');
        document.getElementById('password').oninput = function (e) {
            // Password requirements not shown on login page
        };
        ['username', 'email', 'password', 'confirmPassword'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.oninput = () => clearError(id);
        });

        // Initialize
        generateStars();
        const remEmail = localStorage.getItem('rememberedEmail');
        if (remEmail) {
            document.getElementById('email').value = remEmail;
            document.getElementById('rememberMe').checked = true;
        }
    </script>
</body>
</html>

